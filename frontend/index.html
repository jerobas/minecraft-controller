<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minecraft Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="bg-neutral-950 text-white min-h-screen flex items-center justify-center p-6"
  >
    <div
      class="max-w-2xl w-full mx-auto space-y-6 bg-neutral-900 rounded-2xl p-6 shadow-xl border border-neutral-800"
    >
      <h1 class="text-3xl font-bold text-center mb-4">
        Minecraft Server Panel
      </h1>

      <input
        id="token"
        type="text"
        placeholder="JWT Token"
        class="w-full p-3 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-blue-500"
      />

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
        <button
          id="acceptEula"
          class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg w-full transition"
        >
          Accept EULA
        </button>
        <button
          id="startServer"
          class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg w-full transition"
        >
          Start Server
        </button>
        <button
          id="stopServer"
          class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg w-full transition"
        >
          Stop Server
        </button>
      </div>

      <div>
        <h2 class="font-semibold mt-4 mb-2">Select PaperMC Version</h2>
        <select
          id="paperVersions"
          class="text-black p-3 w-full rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        ></select>
        <button
          id="downloadPaper"
          class="bg-purple-500 hover:bg-purple-600 px-4 py-2 rounded-lg w-full mt-2 transition"
        >
          Download & Use Selected
        </button>
      </div>

      <div>
        <h2 class="font-semibold mt-4 mb-2">Send Command</h2>
        <input
          id="commandInput"
          type="text"
          placeholder="Type command to send"
          class="w-full p-3 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <button
          id="sendCommand"
          class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg w-full mt-2 transition"
        >
          Send Command
        </button>
      </div>

      <div>
        <h2 class="font-semibold mt-4 mb-2">Upload Plugin(s)</h2>
        <input
          id="pluginJar"
          type="file"
          class="block text-black w-full p-3 rounded-lg bg-white"
          multiple
        />
        <button
          id="uploadPlugin"
          class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg w-full mt-2 transition"
        >
          Upload Plugin(s)
        </button>
      </div>

      <div>
        <h2 class="font-semibold mt-4 mb-2">Server Properties</h2>
        <textarea
          id="serverProperties"
          rows="20"
          class="w-full p-4 text-sm font-mono bg-neutral-800 text-neutral-200 rounded-lg border border-neutral-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
        ></textarea>
        <button
          id="saveProperties"
          class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg w-full mt-2 transition"
        >
          Save Properties
        </button>
      </div>

      <div>
        <h2 class="font-semibold mt-4 mb-2">Server Logs</h2>
        <pre
          id="logs"
          class="bg-black rounded-lg p-4 text-sm font-mono h-64 overflow-y-scroll border border-neutral-700"
        ></pre>
      </div>
    </div>

    <script>
      const getHeaders = () => ({
        Authorization: `Bearer ${
          document.getElementById("token").value || "jerobas"
        }`,
      });

      const loadVersions = () => {
        fetch("/paper-versions", { headers: getHeaders() })
          .then((res) => res.json())
          .then((data) => {
            const select = document.getElementById("paperVersions");
            select.innerHTML = "";
            data.versions.reverse().forEach((version) => {
              const option = document.createElement("option");
              option.value = version;
              option.textContent = version;
              select.appendChild(option);
            });
          });
      };

      document.getElementById("acceptEula").onclick = () => {
        fetch("/accept-eula", { method: "POST", headers: getHeaders() });
      };

      document.getElementById("startServer").onclick = () => {
        fetch("/start", { method: "POST", headers: getHeaders() });
      };

      document.getElementById("stopServer").onclick = () => {
        fetch("/stop", { method: "POST", headers: getHeaders() });
      };

      document.getElementById("sendCommand").onclick = () => {
        const command = document.getElementById("commandInput").value;
        fetch("/send-command", {
          method: "POST",
          headers: { "Content-Type": "application/json", ...getHeaders() },
          body: JSON.stringify({ command }),
        });
      };

      document.getElementById("downloadPaper").onclick = () => {
        const version = document.getElementById("paperVersions").value;
        fetch("/download-paper", {
          method: "POST",
          headers: { "Content-Type": "application/json", ...getHeaders() },
          body: JSON.stringify({ version }),
        });
      };

      document.getElementById("uploadPlugin").onclick = () => {
        const files = document.getElementById("pluginJar").files;
        const formData = new FormData();
        Array.from(files).forEach((file) => {
          formData.append("pluginJar", file);
        });
        fetch("/upload-plugin", {
          method: "POST",
          body: formData,
          headers: getHeaders(),
        });
      };

      document.getElementById("saveProperties").onclick = () => {
        const content = document.getElementById("serverProperties").value;
        fetch("/server-properties", {
          method: "POST",
          headers: { "Content-Type": "application/json", ...getHeaders() },
          body: JSON.stringify({ content }),
        });
      };

      const fetchLogs = () => {
        fetch("/logs", { headers: getHeaders() })
          .then((res) => res.text())
          .then((text) => (document.getElementById("logs").textContent = text));
      };

      setInterval(fetchLogs, 3000);

      fetch("/server-properties", { headers: getHeaders() })
        .then((res) => res.json())
        .then((data) => {
          document.getElementById("serverProperties").value = data.content;
        });

      loadVersions();
    </script>
  </body>
</html>
